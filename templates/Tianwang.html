<html>
	<head>
		<link rel="stylesheet" type="text/css" href="../static/Tianwang.css?v={{EDITION}}" />
	</head>
	<body>
		<div class="title"> 剑三警长-天网 </div>
		<div class="notice"> 界面还没有做，先鸽了，咕咕咕。核心逻辑实现了就好啦。 </div>
		<div class="notice"> 本页面显示了对应角色在剑三警长的统计中，拥有的历史最高DPS。 </div>
		
		<div class="map"> 
			<a href="javascript:setMap('25人普通达摩洞')"> 25人普通达摩洞 </a>
			<a href="javascript:setMap('25人英雄达摩洞')"> 25人英雄达摩洞 </a>
		</div>
		
		<table id="table">
		
		</table>
		
	</body>
	
	<script src="../static/jquery-3.3.1.js"></script>
	<script>
		playerDps="{{playerDps}}";
		res1 = playerDps.replaceAll('&#39;', '"');
		res1 = res1.replaceAll('(', "[");
		res1 = res1.replaceAll(')', "]");
		res2 = JSON.parse(res1);
		dpsTable = []
		for (id in res2) {
			var obj = {"name": id};
			for (map in res2[id]) {
				obj[map] = res2[id][map];
			}
			
			stdMaps = ["25人普通达摩洞", "25人英雄达摩洞"];
			for (map in stdMaps) {
				if (!(stdMaps[map] in obj)) {
					obj[stdMaps[map]] = [0, 0, 0, 0, 0, 0];
				}
			}
			
			dpsTable.push(obj);
		}
		
		map = "25人普通达摩洞";
		order = 0;
		
		refreshPage();
		
		function refreshPage() {
			var table=$("#table");
			table.html('');
			
			headers = $("<tr></tr>");
			headers.appendTo(table);
			
			var th = $("<th>"+"角色名"+"</th>");
			th.appendTo(headers);
			var th = $("<th>"+"地图"+"</th>");
			th.appendTo(headers);
			bossName = ["余晖", "宓桃", "武雪散", "猿飞", "哑头陀", "岳琳&岳琅"];
			for (i in bossName) {
				var name = bossName[i];
				var th = $("<th><a href='javascript:setOrder("+ i + ")'>"+name+"</a></th>");
				th.appendTo(headers);
			}
			
			dpsTable.sort(function(x, y){return y[map][order] - x[map][order]});
			
			for (i in dpsTable) {
				dpsItem = dpsTable[i];
				//console.log(id);
				var tr = $("<tr></tr>");
				tr.appendTo(table);
				dpsList1 = [0, 0, 0, 0, 0, 0]
				if (map in dpsItem) {
					dpsList1 = dpsItem[map];
				}
				var td = $("<td>"+dpsItem["name"]+"</td>");
				td.addClass("occ-"+dpsItem["occ"]);
				td.addClass("playerid");
				
				td.appendTo(tr);
				var td = $("<td>"+map+"</td>");
				td.appendTo(tr);
				for (var j in dpsList1) {
					var td = $("<td>"+dpsList1[j]+"</td>");
					td.appendTo(tr);
				}
			}
			
		}
		
		function setMap(s) {
			map = s;
			refreshPage();
		}
		
		function setOrder(s) {
			order = s;
			refreshPage();
		}
		
	</script>
</html>